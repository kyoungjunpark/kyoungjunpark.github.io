nhn.UserAgent=$Class({$init:function(){this.userAgent=window.navigator.userAgent.toLowerCase();var a=this;this.parseDevice(a.userAgent);this.parseVersionOfOS(a.userAgent);this.supportHtmlFive()},parseDevice:function(a){if(a.indexOf("ipod")>-1){this.device="ipod"}else{if(a.indexOf("ipad")>-1||(a.indexOf("macintosh")>-1&&"ontouchend" in document)){this.device="ipad"}else{if(a.indexOf("iphone")>-1){this.device="iphone"}else{this.device="other"}}}},parseVersionOfOS:function(b){if(this.device=="iphone"||this.device=="ipod"){var c=new RegExp("iphone os ([\\d_]+)","i");
var a=c.exec(b);if(a!==null){this.versionOfOS=c.exec(b)[1].replace(new RegExp("\\.","g"),"").replace(new RegExp("_","g"),".")}else{this.versionOfOS=""}}else{if(this.device=="other"){var c=new RegExp("android ([\\d\\.]+)","i");var a=c.exec(b);if(a!==null){this.versionOfOS=c.exec(b)[1]}else{this.versionOfOS=""}}else{this.versionOfOS=""}}},supportHtmlFive:function(){var b=document.createElement("audio");this.isSupportHtmlFive=!!(b.canPlayType&&b.canPlayType("audio/mpeg;").replace(/no/,""))}});nhn.Html5AudioPlayer=$Class({$init:function(){this.playing=false;
this.loading=false;this.audio=new naver.dict.audio.newAudio();this.audio.autoplay=true;this._hTimeout=null;this._attachEvents();this.userAgent=new nhn.UserAgent()},canPlayType:function(){if(this.audio.canPlayType("audio/wav")!="maybe"&&this.audio.canPlayType("audio/wav")!=""){return true}return false},play:function(a){this.sFile=a;this.sList=a.split("|");this.stop();this._loadAudio()},replay:function(){if(this.sFile.indexOf("|")>-1){this.sList=this.sFile.split("|");this.stop();this._loadAudio()}else{this.audio.play()
}},stop:function(){if(this.loading||this.playing){this.audio.pause();this._playEnd()}},_loadAudio:function(){this.audio.src=this.sList.shift();while(this.audio.src==""&&this.sList.length>0){this.audio.src=this.sList.shift()}if(this.audio.src==""){this.audio.pause();this._playEnd()}else{this.audio.load();this.loading=true;this.playing=false;this._delayLoading()}},_attachEvents:function(){var a=this;$Fn(this._canplay,this).attach(this.audio,"canplay");$Fn(this._load,this).attach(this.audio,"loadstart");
$Fn(this._playStart,this).attach(this.audio,"play");$Fn(this._playEnd,this).attach(this.audio,"ended");$Fn(this._playError,this).attach(this.audio,"error");$Fn(this._playWait,this).attach(this.audio,"waiting");if(!this._btnStatusTimeout){this._btnStatusTimeout=setInterval($Fn(function(){if(this.audio.ended===true&&!this.loading&&this.playing){this._playEnd()}},this).bind(),300)}jQuery(a.audio).on("start",function(){jQuery(a).trigger("start")}).on("end",function(){jQuery(a).trigger("end")})},_canplay:function(){if(0.1>this.audio.volume){this.audio.volume=1
}},_load:function(){this.loading=true},_playStart:function(){this.loading=false;this.playing=true;jQuery(this).trigger("start")},_playWait:function(){this.audio.pause();this._playEnd()},_playError:function(a){this.audio.pause();this._playEnd()},_playEnd:function(a){this.audio.pause();if(this.sList.length>0){this._loadAudio()}else{this.playing=false;this.loading=false;jQuery(this).trigger("end")}},_clearTimeout:function(){if(this._hTimeout!==null){clearTimeout(this._hTimeout);this._hTimeout=null}},_delayLoading:function(){this._clearTimeout();
this._hTimeout=setTimeout($Fn(function(){if(this.loading&&!this.playing){alert("로딩이 지연되었습니다.\n다시 시도해 주시기 바랍니다.");this._playEnd()}},this).bind(),30000)}});